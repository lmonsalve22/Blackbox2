@{
    Layout = null;
}

<!doctype html>
<html lang="en" amp>
<head>
    <link rel="preconnect" href="https://analytics.zoho.com">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=9,10,11" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/js/all.min.js" integrity="sha512-YSdqvJoZr83hj76AIVdOcvLWYMWzy6sJyIMic2aQz5kh2bPTd9dzY3NtdeEAzPp/PhgZqr4aJObB3ym/vsItMg==" crossorigin="anonymous"></script>
    <title>Medios</title>

    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
</head>

<body style="background-color: #F2F2F2">

    <style>
        .filter-cat {
            /* margin: 1em 0;*/
        }

        .f-cat {
            color: #fff;
            /*padding: 1em;
            border: 5px solid #fff;*/
            /* background-color: gray !important;*/
        }

        .filter-cat-results .f-cat {
            opacity: 0;
            display: none;
        }

            .filter-cat-results .f-cat.active {
                opacity: 1;
                display: block;
                -webkit-animation: fadeIn 0.65s ease forwards;
                animation: fadeIn 0.65s ease forwards;
            }

        @@-webkit-keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @@keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .card, card-header, card-footer, card-body {
            border: none !important;
        }

            .card:hover {
                border: 2px solid #000 !important;
            }

        .card-body {
            padding: 0px !important;
            margin: 0px !important;
        }
    </style>

    <div class="container filtering">

        <header>
            <div class="row justify-content-center">
                <div class="col-md-10 text-center mt-md-5 mb-md-5">
                    <h1>Data Intelligence</h1>
                </div>
            </div>
        </header>
        <div class="row justify-content-center" style="background-color: #524094; color: white;">

            <div class="col-12 col-md-4 mt-3 mb-1">
                <div class="row">
                    <div class="col-12 col-md-4 ">
                        <p style="font-size:0.9rem" class="pt-1">SELECCIONAR: </p>
                    </div>
                    <div class="col-12 col-md-8 ">

                        <select style="border: none; width:98%; font-size: 1.1rem;padding:2px 0px  " @*class="form-control"*@>

                            @*@foreach (var item in ViewBag.datos)
                                {
                                    <option value="@item.parametro3_id">@item.parametro3_id</option>
                                }*@
                            <option value="cat-all">Todos</option>
                            @foreach (var item in ViewBag.filtro)
                            {
                                <option value="@item">@item</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4 mt-3">
                <div class="row">
                    <div class="col-12 col-md-3">
                        <p style="font-size:0.9rem" class="pt-1">FRUTA:</p>
                    </div>
                    <div class="col-12 col-md-9">
                        <select style="border: none; width: 100%; font-size: 1.1rem; padding: 2px 0px " @*class="form-control"*@>
                            <option value="cat-all">Todos</option>
                            @foreach (var item in ViewBag.filtro2)
                            {
                                <option value="@item">@item</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <!--script y estilos de buscador-->
            <div class="col-12 col-md-4 mt-3 ">
                <script>
                    const removeAccents = (str) => {
                        return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    }
                    function FiltroBuscar() {
                        var input, filter, contenedor, titulo, card, i, txtValue;
                        input = document.getElementById("buscador");
                        filter = removeAccents(input.value.toLowerCase());
                        contenedor = document.getElementById("myCards");
                        titulo = contenedor.getElementsByTagName("h6");
                        cartas = contenedor.getElementsByClassName("f-cat");
                        for (i = 0; i < titulo.length; i++) {
                            card = titulo[i].getElementsByTagName("a")[0];
                            txtValue = card.textContent || card.innerText;
                            if (removeAccents(txtValue.toLowerCase()).indexOf(filter) > -1) {

                                cartas[i].style.display = "";
                            } else {
                                cartas[i].style.display = "none";

                            }
                        }
                    }
                </script>

                <!--script de buscador-->
                <input style="width:80%; margin-left:5%;" type="text" id="buscador" onkeyup="FiltroBuscar()" placeholder="Buscar.." title="Ingrese un texta">
            </div>
        </div>

        <div class="row justify-content-center mt-5 ">

            <div id="myCards" class="cards row filter-cat-results justify-content-center">
                <style>
                    .card:hover {
                        border: 2px solid #000 !important;
                    }
                </style>
                @*<script>
                        $(document).ready(function () {
                            $(".abrirIframe").click(function (e) {
                                e.preventDefault();
                                $("embed").attr("src", $(this).attr('href'));
                            });

                        });

                        $(document).ready(function () {
                            $("#testModal").click(function (e) {
                                //alert("Hola");
                                //$("iframe").attr("src", 'about:blank');
                                //$("iframe").contentWindow.location.reload(true);
                                //alert("Hola")
                            });

                        }, 2000);
                    </script>*@

                @foreach (var item in ViewBag.datos)
                {
                    <div class="col-12 col-md-4 f-cat" data-cat="@item.parametro3">
                        <div class="card border-success mb-3" style="margin: auto; max-width: 28rem; background-color: #ffffff;">
                            <div class="card-header bg-transparent " style="border-bottom:none">
                                <h6>
                                    <a href="#" style="color:black;text-decoration:none;cursor:default;">
                                        @item.parametro3
                                        <i data-bs-toggle="modal" data-bs-target="#@item.parametro3.Replace(" ","_")@item.id" style="font-size:1.2rem; color:gray; cursor:pointer; float:right;" title="Pantalla Completa" class="fas fa-expand-alt"></i>
                                    </a>
                                </h6>
                            </div>

                            <div class="card-body text-success">
                                <div class="ratio ratio-4x3">
                                    @*<iframe id="test12" src="@item.url_miniatura" title="Limón" allowfullscreen></iframe>*@
                                    @*<iframe id="test12" src="https://analytics.zoho.com/open-view/2395394000011427697?ZOHO_CRITERIA=%22Fruta%20Consolidado%22.%22Mercado%20ID%22%3D6%20and%20%22Fruta%20Consolidado%22.%22Categor%C3%ADa%20ID%22%3D100112025" title="Limón" allowfullscreen></iframe>*@
                                    <img src="@item.url_miniatura">
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!--PERIODICIDAD-->
            </div>
            <!--SECCIóN DE MODAL DE GRAFICOS -->
            <section>

                @foreach (var item in ViewBag.datos)
                {
                    <div class="modal fade" id="@item.parametro3.Replace(" ","_")@item.id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button @*id="testModal"*@ type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    @*<h4 class="modal-title" id="myModalLabel">Modal title</h4>*@
                                </div>
                                <div class="modal-body">
                                    <embed type="video/webm" src="@item.url_extendida" width="100%" height="500" frameborder="0" allowtransparency="true">
                                    <p>
                                        @item.aux
                                    </p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                }
                <!-- Modal Higo -->
            </section>
        </div>
    </div>

    @*script funcional de filtro de dropdown*@
    <script>
        var filterActive;

        function filterCategory(category) {
            if (filterActive != category) {

                // reset results list
                $('.filter-cat-results .f-cat').removeClass('active');

                // elements to be filtered
                $('.filter-cat-results .f-cat')
                    .filter('[data-cat="' + category + '"]')
                    .addClass('active');

                // reset active filter
                filterActive = category;
            }
        }

        $('.f-cat').addClass('active');

        $('.filtering select').change(function () {
            if ($(this).val() == 'cat-all') {
                $('.filter-cat-results .f-cat').addClass('active');
                filterActive = 'cat-all';
            } else {
                filterCategory($(this).val());
            }
        });
    </script>
    @*Filtro funcional de filtro de dropdown*@

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>

        function renderCard(elemento) {
            var html = '<div><div class="col-12 col-md-4 f-cat" data-cat="' + elemento.FRUTA + '">';
            html = html + '<div class="card mb-3" style="margin: auto; max-width: 28rem; background-color: #ffffff;">';
            //html = html + '<div class="card-header bg-transparent " style="border-bottom:none"><h6>';
            //html = html + '<a href="#" style="color:black;text-decoration:none;cursor:default;">' + elemento.FRUTA;
            //html = html + '<i data-bs-toggle="modal" data-bs-target="#myModal" style="font-size:1.2rem; color:gray; cursor:pointer; float:right;" title="Pantalla Completa" class="fas fa-expand-alt"></i></a>';
            //html = html + '</h6></div><div class="card-body" style="margin:0px !important;padding:0px !important;">';
            //html = html + '<div class="ratio ratio-4x3"><iframe id = "test12" src = "' + elemento.URL_MINIATURA + '" title="Higo" allowfullscreen></iframe></div>';
            html = html + '</div></div></div>';
            return html;

        }
        $.get("https://raw.githubusercontent.com/Sud-Austral/datos_monitor/main/fruta1.csv", function (data) {
            var datos = data;

            var filas = datos.split("\n");
            var tabla = []

            for (var i = 1; i < filas.length; i++) {
                //alert(fila.split(",").length)
                var registros = {
                    MERCADO: filas[i].split(",")[2],
                    TIPO_FRUTA: filas[i].split(",")[4],
                    FRUTA: filas[i].split(",")[5],
                    URL_MINIATURA: filas[i].split(",")[7],
                    URL_EXPANDIDA: filas[i].split(",")[8]
                }
                tabla.push(registros);

            }
            $("#myCards").append(renderCard(tabla[0]))
            //console.log()
            //$("#myCards").append('<div class="col-12 col-md-4 f-cat" data-cat="Frambuesa"><div class="card mb-3" style="margin: auto; max-width: 28rem; background-color: #ffffff;"><div class="card-header bg-transparent " style="border-bottom:none"><h6><a href="#" style="color:black;text-decoration:none;cursor:default;">Frambuesa<i data-bs-toggle="modal" data-bs-target="#myModal" style="font-size:1.2rem; color:gray; cursor:pointer; float:right;" title="Pantalla Completa" class="fas fa-expand-alt"></i></a></h6></div><div class="card-body" style="margin:0px !important;padding:0px !important;"><div class="ratio ratio-4x3"><iframe id="test12" src="https://analytics.zoho.com/open-view/2395394000010977241?ZOHO_CRITERIA=%22Fruta%20Consolidado%22.%22Mercado%20ID%22%3D6%20and%20%22Fruta%20Consolidado%22.%22Categor%C3%ADa%20ID%22%3D100101004" title="Higo" allowfullscreen></iframe></div></div></div></div>')
            //console.log(tabla[0]);

        });
    </script>
</body>
</html>